DROP TABLE CDMS.CERTIFICATE_OF_DEPOSIT_INFO CASCADE CONSTRAINTS PURGE;

--
-- CERTIFICATE_OF_DEPOSIT_INFO  (Table) 
--
CREATE TABLE CDMS.CERTIFICATE_OF_DEPOSIT_INFO
(
  CERTIFICATES_OF_DEPOSIT_ID    VARCHAR2(20 BYTE),
  CERTIFICATES_OF_DEPOSIT_NAME  VARCHAR2(64 BYTE) NOT NULL,
  CURRENCY                      VARCHAR2(4 BYTE) DEFAULT 'CNY' NOT NULL,
  TOTAL_AMOUNT                  NUMBER(32,2)    NOT NULL,
  RESIDUAL_AMOUNT               NUMBER(32,2)    NOT NULL,
  MAX_AMOUNT_PER                NUMBER(32,2)    NOT NULL,
  MIN_AMOUNT                    NUMBER(32,2)    NOT NULL,
  START_DATE                    DATE            DEFAULT sysdate+1             NOT NULL,
  END_DATE                      DATE            DEFAULT sysdate+31            NOT NULL,
  ANNUAL_RATE                   VARCHAR2(12 BYTE) NOT NULL,
  STATUS                        CHAR(1 BYTE)    DEFAULT '1'
)
LOGGING 
NOCOMPRESS 
NOCACHE;

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.CERTIFICATES_OF_DEPOSIT_ID IS '大额存单产品ID';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.CERTIFICATES_OF_DEPOSIT_NAME IS '产品名称';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.CURRENCY IS '币种';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.TOTAL_AMOUNT IS '产品可售卖总金额';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.RESIDUAL_AMOUNT IS '产品剩余可售卖总金额 ';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.MAX_AMOUNT_PER IS '每人可购买总金额上限';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.MIN_AMOUNT IS '每次购买最低金额';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.START_DATE IS '起售日期';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.END_DATE IS '结束购买日期';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_INFO.ANNUAL_RATE IS '年化利率';


DROP TABLE CDMS.CERTIFICATE_OF_DEPOSIT_ORDER CASCADE CONSTRAINTS PURGE;

--
-- CERTIFICATE_OF_DEPOSIT_ORDER  (Table) 
--
CREATE TABLE CDMS.CERTIFICATE_OF_DEPOSIT_ORDER
(
  ORDER_NO                    NUMBER(20)        NOT NULL,
  CUST_NO                     NUMBER(20)        NOT NULL,
  AMOUNT                      NUMBER(32,2)      NOT NULL,
  ORDER_DATE                  DATE              DEFAULT sysdate               NOT NULL,
  CERTIFICATES_OF_DEPOSIT_ID  VARCHAR2(20 BYTE) NOT NULL,
  STATUS                      INTEGER
)
LOGGING 
NOCOMPRESS 
NOCACHE;

COMMENT ON TABLE CDMS.CERTIFICATE_OF_DEPOSIT_ORDER IS '存单销售流水表';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_ORDER.ORDER_NO IS '订单号';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_ORDER.CUST_NO IS '订单人ID';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_ORDER.AMOUNT IS '购买数量';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_ORDER.ORDER_DATE IS '购买日期';

COMMENT ON COLUMN CDMS.CERTIFICATE_OF_DEPOSIT_ORDER.CERTIFICATES_OF_DEPOSIT_ID IS '产品ID';


--
-- PK_CERTIFICATE_OF_DEPOSIT_ORDER  (Index) 
--
CREATE UNIQUE INDEX CDMS.PK_CERTIFICATE_OF_DEPOSIT_ORDER ON CDMS.CERTIFICATE_OF_DEPOSIT_ORDER
(ORDER_NO)
LOGGING;

ALTER TABLE CDMS.CERTIFICATE_OF_DEPOSIT_ORDER ADD (
  CONSTRAINT PK_CERTIFICATE_OF_DEPOSIT_ORDER
  PRIMARY KEY
  (ORDER_NO)
  USING INDEX CDMS.PK_CERTIFICATE_OF_DEPOSIT_ORDER
  ENABLE VALIDATE);


DROP TABLE CDMS.CUST_BALANCE CASCADE CONSTRAINTS PURGE;

--
-- CUST_BALANCE  (Table) 
--
CREATE TABLE CDMS.CUST_BALANCE
(
  CUST_NO           VARCHAR2(20 BYTE),
  CURRENCY          VARCHAR2(3 BYTE)            DEFAULT 'CNY'                 NOT NULL,
  BALANCE           NUMBER(32,2)                NOT NULL,
  BALANCE_AVL       NUMBER(32,2),
  LAST_CHANGE_DATE  DATE                        DEFAULT NULL,
  YD_BALANCE        NUMBER(32,2)
)
LOGGING 
NOCOMPRESS 
NOCACHE;

COMMENT ON TABLE CDMS.CUST_BALANCE IS '余额明细';

COMMENT ON COLUMN CDMS.CUST_BALANCE.CUST_NO IS '用户ID';

COMMENT ON COLUMN CDMS.CUST_BALANCE.CURRENCY IS '币种';

COMMENT ON COLUMN CDMS.CUST_BALANCE.BALANCE IS '可用余额';

COMMENT ON COLUMN CDMS.CUST_BALANCE.LAST_CHANGE_DATE IS '上次修改时间';

COMMENT ON COLUMN CDMS.CUST_BALANCE.YD_BALANCE IS '昨日余额';


--
-- PK_CUST_BALANCE  (Index) 
--
CREATE UNIQUE INDEX CDMS.PK_CUST_BALANCE ON CDMS.CUST_BALANCE
(CUST_NO, CURRENCY)
LOGGING;

ALTER TABLE CDMS.CUST_BALANCE ADD (
  CONSTRAINT PK_CUST_BALANCE
  PRIMARY KEY
  (CUST_NO, CURRENCY)
  USING INDEX CDMS.PK_CUST_BALANCE
  ENABLE VALIDATE);


DROP TABLE CDMS.CUST_INFO CASCADE CONSTRAINTS PURGE;

--
-- CUST_INFO  (Table) 
--
CREATE TABLE CDMS.CUST_INFO
(
  CUST_NO        VARCHAR2(20 BYTE),
  CUST_NAME      VARCHAR2(64 BYTE)              NOT NULL,
  CUST_PASSWORD  VARCHAR2(64 BYTE)              NOT NULL,
  CUST_SEX       VARCHAR2(4 BYTE)               NOT NULL,
  PHONE_NUMBER   VARCHAR2(20 BYTE)              NOT NULL,
  STATUS         VARCHAR2(1 BYTE)               DEFAULT NULL                  NOT NULL
)
LOGGING 
NOCOMPRESS 
NOCACHE;

COMMENT ON COLUMN CDMS.CUST_INFO.CUST_NO IS '用户ID';

COMMENT ON COLUMN CDMS.CUST_INFO.CUST_NAME IS '用户名称';

COMMENT ON COLUMN CDMS.CUST_INFO.CUST_PASSWORD IS '密码';

COMMENT ON COLUMN CDMS.CUST_INFO.CUST_SEX IS '用户性别';

COMMENT ON COLUMN CDMS.CUST_INFO.PHONE_NUMBER IS '电话';

COMMENT ON COLUMN CDMS.CUST_INFO.STATUS IS '状态';


--
-- PK_CUST_INFO  (Index) 
--
CREATE UNIQUE INDEX CDMS.PK_CUST_INFO ON CDMS.CUST_INFO
(CUST_NO)
LOGGING;

ALTER TABLE CDMS.CUST_INFO ADD (
  CONSTRAINT PK_CUST_INFO
  PRIMARY KEY
  (CUST_NO)
  USING INDEX CDMS.PK_CUST_INFO
  ENABLE VALIDATE);


DROP TABLE CDMS.T_RUN_LOG_INFO CASCADE CONSTRAINTS PURGE;

--
-- T_RUN_LOG_INFO  (Table) 
--
CREATE TABLE CDMS.T_RUN_LOG_INFO
(
  PROC_ID   NUMBER                              NOT NULL,
  LOG_DATE  DATE                                DEFAULT sysdate               NOT NULL,
  LOG_STEP  VARCHAR2(30 BYTE),
  LOG_MSG   VARCHAR2(300 BYTE),
  LOG_AMT1  INTEGER,
  LOG_AMT2  NUMBER
)
LOGGING 
NOCOMPRESS 
NOCACHE;


--
-- IDX_CERTIFICATE_OF_DEPOSIT_CUST  (Index) 
--
CREATE INDEX CDMS.IDX_CERTIFICATE_OF_DEPOSIT_CUST ON CDMS.CERTIFICATE_OF_DEPOSIT_ORDER
(CUST_NO, CERTIFICATES_OF_DEPOSIT_ID)
LOGGING;

--
-- TR_CERTIFICATE_OF_DEPOSIT_INFO  (Trigger) 
--
CREATE OR REPLACE TRIGGER CDMS.TR_CERTIFICATE_OF_DEPOSIT_INFO
BEFORE INSERT ON CDMS.CERTIFICATE_OF_DEPOSIT_INFO
FOR EACH ROW
DISABLE
BEGIN
   --IF NVL(TRIM(:NEW.CERTIFICATESOF_DEPOSIT_ID),' ')=' ' THEN
   SELECT SE_CERTIFICATE_OF_DEPOSIT_INFO.nextval  INTO :NEW.CERTIFICATESOF_DEPOSIT_ID FROM DUAL;
   --END IF;
END ;
/


DROP SEQUENCE CDMS.SE_CUST_INFO;

--
-- SE_CUST_INFO  (Sequence) 
--
CREATE SEQUENCE CDMS.SE_CUST_INFO
  START WITH 90
  MAXVALUE 9999999999
  MINVALUE 0
  NOCYCLE
  CACHE 20
  ORDER
  NOKEEP
  NOSCALE
  GLOBAL;


--
-- TR_PK_CUST_INFO  (Trigger) 
--
CREATE OR REPLACE TRIGGER CDMS.TR_PK_CUST_INFO
BEFORE INSERT ON CDMS.CUST_INFO
FOR EACH ROW
BEGIN
   SELECT SE_CUST_INFO.nextval  INTO :NEW.CUST_NO FROM DUAL;
END TR_PK_CUST_INFO;
/
